<div class="dashboard-container">

  <header class="top-bar">
    <div class="brand">
      <span class="icon">üîó</span>
      <h1>URL Shortener</h1>
    </div>

    @if (isLoggedIn) {
      <div class="user-info">
        <span class="user-badge">{{ currentUserEmail }}</span>
        <button (click)="logout()" class="btn-logout">–í–∏–π—Ç–∏ üö™</button>
      </div>
    } @else {
      <a routerLink="/login" class="btn-login">–£–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É üîë</a>
    }
  </header>

  @if (isLoggedIn) {
    <section class="create-section">
      <div class="input-card">
        <h2>–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</h2>
        <div class="input-group">
          <input
            type="text"
            [formControl]="urlInput"
            placeholder="–í—Å—Ç–∞–≤—Ç–µ –¥–æ–≤–≥–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (https://...)"
            [class.error]="urlInput.invalid && urlInput.touched"
          />
          <button
            (click)="onShorten()"
            [disabled]="urlInput.invalid || isLoading"
          >
            {{ isLoading ? '‚úÇÔ∏è –û–±—Ä–æ–±–∫–∞...' : '–°–∫–æ—Ä–æ—Ç–∏—Ç–∏' }}
          </button>
        </div>

        @if (errorMessage) {
          <div class="alert-error">{{ errorMessage }}</div>
        }
        @if (urlInput.invalid && urlInput.touched) {
          <small class="text-error">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –º–∞—î –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑ http:// –∞–±–æ https://</small>
        }
      </div>
    </section>
  }

  <section class="history-section">
    <h2>–í—Å—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</h2>

    @if (urls.length === 0 && !isLoading) {
      <div class="empty-state">
        <p>–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π.</p>
      </div>
    } @else {
      <div class="table-responsive">
        <table>
          <thead>
          <tr>
            <th style="width: 35%">–û—Ä–∏–≥—ñ–Ω–∞–ª</th>
            <th style="width: 20%">–ö–æ—Ä–æ—Ç–∫–µ</th>
            <th style="width: 20%">–í–ª–∞—Å–Ω–∏–∫</th>
            <th style="width: 10%">–ö–ª—ñ–∫–∏</th>
            <th style="width: 15%">–î–∞—Ç–∞</th>
            @if (isLoggedIn) {
              <th>–î—ñ—ó</th>
            }
          </tr>
          </thead>
          <tbody>
            @for (url of urls; track url.id) {
              <tr>
                <td class="col-original">
                  <div class="truncate">
                    <a [href]="url.originalUrl" target="_blank">{{ url.originalUrl }}</a>
                  </div>
                </td>

                <td class="col-short">
                  <a [href]="redirectBaseUrl + url.shortCode" target="_blank" class="short-pill">
                    {{ url.shortCode }} ‚Üó
                  </a>
                </td>

                <td class="col-user">
                  <span class="user-label">{{ url.createdBy || '–ê–Ω–æ–Ω—ñ–º' }}</span>
                </td>

                <td class="col-clicks">
                  {{ url.clickCount }} üëÄ
                </td>

                <td class="col-date">{{ url.dateCreated | date:'dd.MM.yyyy' }}</td>

                @if (isLoggedIn) {
                  <td class="col-actions">
                    <a [routerLink]="['/urls', url.id]" class="btn-icon info" title="–î–µ—Ç–∞–ª—ñ">‚ÑπÔ∏è</a>

                    @if (canDelete(url)) {
                      <button class="btn-icon delete" (click)="onDelete(url.id)" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóë</button>
                    }
                  </td>
                }
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </section>
</div>
